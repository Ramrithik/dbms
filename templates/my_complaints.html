{% extends 'layout.html' %} 
{% block title %}My Complaints{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
    <h2 class="text-3xl font-bold text-gray-900 mb-6">My Complaint History</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-2">
        {% for category, message in messages %}
          <div class="p-4 rounded-md {% if category == 'success' %}bg-green-100 border border-green-300 text-green-800{% elif category == 'danger' %}bg-red-100 border border-red-300 text-red-800{% else %}bg-blue-100 border border-blue-300 text-blue-800{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <a href="{{ url_for('file_complaint') }}" class="inline-block px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg shadow-md hover:bg-indigo-700 transition-colors mb-6">
      File a New Complaint
    </a>
    
    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
              <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date Filed</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
              {% if complaints %}
                  {% for complaint in complaints %}
                  <tr class="hover:bg-gray-50">
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ complaint.id }}</td>
                      <td class_name="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{ complaint.complaint_date.strftime('%Y-%m-%d') }}</td>
                      <td class_name="px-6 py-4 whitespace-normal text-sm text-gray-700">{{ complaint.issue }}</td>
                      <td class_name="px-6 py-4 whitespace-nowrap text-sm">
                          {% if complaint.status == False %}
                              <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                  Pending
                              </span>
                          {% else %}
                              <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                  Resolved
                              </span>
                          {% endif %}
                      </td>
                  </tr>
                  {% endfor %}
              {% else %}
                  <tr>
                      <td colspan="4" class="px-6 py-4 text-center text-gray-500">You have not filed any complaints.</td>
                  </tr>
              {% endif %}
          </tbody>
      </table>
    </div>
    
    <a href="{{ url_for('student_dashboard') }}" class="inline-block mt-6 text-indigo-600 hover:text-indigo-800">
      &larr; Back to Dashboard
    </a>
</div>
{% endblock %}